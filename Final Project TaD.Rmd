---
title: "Final Project"
author: "Carlo Gre√ü"
date: "2023-11-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(rvest)
library(dplyr)
library(purrr)
```

### Scraping all links available for the years 2003 to 2023
```{r}
url <- "https://www.opec.org/opec_web/en/press_room/307.htm"

# Read the HTML content of the webpage
page <- read_html(url)

# Locate the div with the class "archives" and then select all 'option' elements within it
options <- page %>% html_nodes(".archives option")

# Extract both 'value' attribute and text content
data <- data.frame(
  value = options %>% html_attr("value"),
  year = options %>% html_text()
)

# Removing first row since it is not including a linke
data <- data %>% slice(-1)

# Adding shared first part of the url to all hrefs
data <- data %>% mutate(value = paste0("opec.org", value))

# Print the extracted data
print(data)
```

```{r}
data$value <- paste0("https://www.", data$value)


```


```{r}


# Function to extract links from a single URL
extract_links <- function(url) {
  page <- read_html(url)
  all_links <- page %>% html_nodes('.slim.articles a')
  links <- html_attr(all_links, "href")
  return(links)
}

# Apply the function to each URL in the DataFrame
all_extracted_links <- data %>%
  mutate(extracted_links = map(value, extract_links)) %>%
  pull(extracted_links) %>%
  unlist()
all_extracted_links <- paste0("https://www.opec.org", all_extracted_links)

# View the character list with all the extracted links
print(all_extracted_links)

all_extracted_links <- all_extracted_links[!grepl("^https://www.opec.orghttp://", all_extracted_links)]

# View the modified character vector
print(all_extracted_links)


```

```{r}
extract_text_from_link <- function(url) {
  Sys.sleep(2)  # Introduce a 2-second delay
  webpage <- read_html(url)
  parsed_nodes <- html_nodes(webpage, xpath = '//p')
  speech_text <- html_text(parsed_nodes)
  return(speech_text)
}

all_speech_text <- lapply(all_extracted_links, extract_text_from_link)

head(all_speech_text)
```

